/**
 * TipTap Editor Styles for iOS Notes
 *
 * Standards Applied:
 * - iOS Dynamic Type support via -apple-system-body
 * - Fluid typography with accessible clamp() (rem + vw)
 * - Apple HIG spacing: 16px iPhone, 24px iPad margins
 * - 8-point grid system for spacing
 * - 44pt minimum touch targets
 * - WCAG 2.1 AA compliant text resizing
 * - Apple-inspired spring motion design
 *
 * References:
 * - Apple Human Interface Guidelines (Typography, Layout, Motion)
 * - WCAG 1.4.4 Resize Text (200% zoom support)
 * - WWDC23: Animate with springs
 */

/* ============================================================================
   CSS CUSTOM PROPERTIES - Design Tokens
   Based on Apple HIG 8-point grid system
   ============================================================================ */

:root {
  /* -------------------------------------------------------------------------
     MOTION DESIGN SYSTEM
     Based on Apple's spring animation principles (WWDC23)
     Using cubic-bezier with overshoot to approximate spring physics
     ------------------------------------------------------------------------- */

  /* Spring Curves - Approximate iOS spring physics */
  /* These use cubic-bezier with values >1 to create overshoot/bounce */

  /* Responsive Spring: For buttons, toggles, immediate feedback
     Fast response, subtle bounce - feels snappy and alive */
  --motion-spring-responsive: cubic-bezier(0.34, 1.56, 0.64, 1);

  /* Gentle Spring: For hover states, focus rings
     Subtle overshoot, settles quickly */
  --motion-spring-gentle: cubic-bezier(0.175, 0.885, 0.32, 1.1);

  /* Expressive Spring: For modal/panel animations, major transitions
     More pronounced bounce, feels playful and iOS-like */
  --motion-spring-expressive: cubic-bezier(0.34, 1.8, 0.64, 1);

  /* Slide Spring: For slide-in panels, navigation transitions
     Smooth deceleration with slight overshoot */
  --motion-spring-slide: cubic-bezier(0.25, 1.25, 0.5, 1);

  /* Standard Easing (non-spring, for subtle changes) */
  --motion-ease-out: cubic-bezier(0.33, 1, 0.68, 1);
  --motion-ease-in-out: cubic-bezier(0.65, 0, 0.35, 1);

  /* Duration Scale - Based on Apple's "quick, precise" principle */
  --motion-duration-instant: 100ms;   /* Micro-interactions */
  --motion-duration-fast: 150ms;      /* Button states, toggles */
  --motion-duration-normal: 250ms;    /* Standard transitions */
  --motion-duration-slow: 350ms;      /* Panel slides, modal */
  --motion-duration-slower: 500ms;    /* Complex choreography */

  /* Combined Transition Presets */
  --motion-button: var(--motion-duration-fast) var(--motion-spring-responsive);
  --motion-hover: var(--motion-duration-fast) var(--motion-spring-gentle);
  --motion-toggle: var(--motion-duration-normal) var(--motion-spring-responsive);
  --motion-slide: var(--motion-duration-slow) var(--motion-spring-slide);
  --motion-fade: var(--motion-duration-normal) var(--motion-ease-out);

  /* -------------------------------------------------------------------------
     TYPOGRAPHY SCALE
     ------------------------------------------------------------------------- */

  /* Large Title: 34pt native, scales 28-40px */
  --ios-font-large-title: clamp(1.75rem, calc(1.5rem + 1vw), 2.5rem);

  /* Title 1: 28pt native, scales 24-34px */
  --ios-font-title1: clamp(1.5rem, calc(1.25rem + 0.75vw), 2.125rem);

  /* Title 2: 22pt native, scales 20-28px */
  --ios-font-title2: clamp(1.25rem, calc(1.125rem + 0.5vw), 1.75rem);

  /* Title 3: 20pt native, scales 18-24px */
  --ios-font-title3: clamp(1.125rem, calc(1rem + 0.375vw), 1.5rem);

  /* Body: 17pt native - base size, scales 16-20px */
  --ios-font-body: clamp(1rem, calc(0.9375rem + 0.25vw), 1.25rem);

  /* Callout: 16pt native */
  --ios-font-callout: clamp(0.9375rem, calc(0.875rem + 0.1875vw), 1.125rem);

  /* Footnote: 13pt native */
  --ios-font-footnote: clamp(0.8125rem, calc(0.75rem + 0.125vw), 0.9375rem);

  /* Line heights per Apple HIG */
  --ios-line-height-tight: 1.2;
  --ios-line-height-normal: 1.47059; /* 25/17 - Apple's body line height */
  --ios-line-height-relaxed: 1.5;

  /* Spacing - 8-point grid system */
  --ios-spacing-xs: 4px;   /* 0.5 units */
  --ios-spacing-sm: 8px;   /* 1 unit */
  --ios-spacing-md: 16px;  /* 2 units - iPhone margin */
  --ios-spacing-lg: 24px;  /* 3 units - iPad margin */
  --ios-spacing-xl: 32px;  /* 4 units */
  --ios-spacing-2xl: 40px; /* 5 units */
  --ios-spacing-3xl: 48px; /* 6 units */

  /* Touch targets - Apple HIG minimum 44pt */
  --ios-touch-target-min: 44px;

  /* Colors - iOS system colors */
  --ios-text-primary: #fff;
  --ios-text-secondary: #98989d;
  --ios-text-tertiary: #636366;
  --ios-bg-primary: #000;
  --ios-bg-secondary: #1c1c1e;
  --ios-bg-tertiary: #2c2c2e;
  --ios-yellow: #ffd60a;
  --ios-blue: #0a84ff;
  --ios-separator: #38383a;
}

/* Light mode color overrides */
@media (prefers-color-scheme: light) {
  :root {
    --ios-text-primary: #000;
    --ios-text-secondary: #6c6c70;
    --ios-text-tertiary: #aeaeb2;
    --ios-bg-primary: #fff;
    --ios-bg-secondary: #f2f2f7;
    --ios-bg-tertiary: #e5e5ea;
    --ios-separator: #c6c6c8;
  }
}

/* ============================================================================
   iOS DYNAMIC TYPE SUPPORT
   Hooks into iOS system text size preferences
   ============================================================================ */

/*
 * When supported, use Apple's system font which respects Dynamic Type settings.
 * The -apple-system-body font automatically scales based on user preferences.
 * We then use em units to adjust relative to the system-chosen base size.
 */
@supports (font: -apple-system-body) {
  .ios-tiptap-wrapper {
    font: -apple-system-body;
  }
}

/* ============================================================================
   WRAPPER
   ============================================================================ */

.ios-tiptap-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-y;
  overscroll-behavior: contain;

  /* Fallback font stack for non-Apple devices */
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', system-ui, sans-serif;
}

/* ============================================================================
   MAIN EDITOR
   Responsive margins per Apple HIG:
   - iPhone (< 768px): 16px horizontal margins
   - iPad (768px+): 24px horizontal margins
   - Large screens (1024px+): 40px horizontal margins
   ============================================================================ */

.ios-tiptap-editor {
  flex: 1;
  outline: none;

  /* iPhone margins - 16px per Apple HIG */
  padding: var(--ios-spacing-md) var(--ios-spacing-md);

  /* Typography */
  font-size: var(--ios-font-body);
  line-height: var(--ios-line-height-normal);
  color: var(--ios-text-primary);

  /* Text rendering optimization */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* iPad breakpoint - 24px margins */
@media (min-width: 768px) {
  .ios-tiptap-editor {
    padding: var(--ios-spacing-lg) var(--ios-spacing-lg);
  }
}

/* Large screens - increased margins for readability */
@media (min-width: 1024px) {
  .ios-tiptap-editor {
    padding: var(--ios-spacing-lg) var(--ios-spacing-2xl);
    /* Optimal line length for readability: 45-75 characters */
    max-width: 70ch;
  }
}

/* ============================================================================
   PLACEHOLDER
   ============================================================================ */

.ios-tiptap-editor.is-editor-empty::before {
  content: attr(data-placeholder);
  color: var(--ios-text-tertiary);
  pointer-events: none;
  position: absolute;
  height: 0;
}

.ios-tiptap-editor p.is-editor-empty:first-child::before {
  content: attr(data-placeholder);
  color: var(--ios-text-tertiary);
  pointer-events: none;
  float: left;
  height: 0;
}

/* ============================================================================
   PARAGRAPHS
   Spacing based on 8-point grid
   ============================================================================ */

.ios-tiptap-editor p {
  margin: 0;
  padding: 0;
  min-height: 1.5em;
}

.ios-tiptap-editor p + p {
  margin-top: var(--ios-spacing-sm); /* 8px - 1 grid unit */
}

/* ============================================================================
   HEADINGS
   Apple HIG Typography Scale with fluid sizing
   ============================================================================ */

.ios-tiptap-editor h1 {
  font-size: var(--ios-font-large-title);
  font-weight: 700;
  color: var(--ios-yellow);
  margin: 0 0 var(--ios-spacing-sm) 0;
  line-height: var(--ios-line-height-tight);
  letter-spacing: -0.022em; /* Apple's Large Title tracking */
}

.ios-tiptap-editor h2 {
  font-size: var(--ios-font-title1);
  font-weight: 700;
  color: var(--ios-text-primary);
  margin: var(--ios-spacing-md) 0 var(--ios-spacing-sm) 0;
  line-height: var(--ios-line-height-tight);
  letter-spacing: -0.020em; /* Apple's Title 1 tracking */
}

.ios-tiptap-editor h3 {
  font-size: var(--ios-font-title2);
  font-weight: 600;
  color: var(--ios-text-secondary);
  margin: var(--ios-spacing-md) 0 var(--ios-spacing-sm) 0;
  line-height: 1.3;
  letter-spacing: -0.017em; /* Apple's Title 2 tracking */
}

/* ============================================================================
   TEXT FORMATTING
   ============================================================================ */

.ios-tiptap-editor strong {
  font-weight: 600;
}

.ios-tiptap-editor em {
  font-style: italic;
}

.ios-tiptap-editor u {
  text-decoration: underline;
  text-underline-offset: 0.15em;
}

.ios-tiptap-editor s {
  text-decoration: line-through;
}

/* Highlight (for future entity highlighting) */
.ios-tiptap-editor mark {
  background-color: var(--ios-yellow);
  color: var(--ios-bg-primary);
  border-radius: 2px;
  padding: 0.0625em 0.125em; /* 1px 2px at base size */
}

/* ============================================================================
   LISTS
   Spacing on 8-point grid
   ============================================================================ */

.ios-tiptap-editor ul,
.ios-tiptap-editor ol {
  margin: var(--ios-spacing-sm) 0;
  padding-left: 1.5em;
}

.ios-tiptap-editor li {
  margin: var(--ios-spacing-xs) 0; /* 4px - half grid unit */
}

.ios-tiptap-editor li p {
  margin: 0;
}

/* Bullet list */
.ios-tiptap-editor ul:not([data-type="taskList"]) {
  list-style-type: disc;
}

.ios-tiptap-editor ul:not([data-type="taskList"]) li::marker {
  color: var(--ios-yellow);
}

/* Numbered list */
.ios-tiptap-editor ol {
  list-style-type: decimal;
}

.ios-tiptap-editor ol li::marker {
  color: var(--ios-yellow);
  font-weight: 500;
}

/* ============================================================================
   TASK LIST
   iOS-style circular checkboxes with 44pt touch targets
   ============================================================================ */

.ios-tiptap-editor ul[data-type="taskList"] {
  list-style: none;
  padding-left: 0;
  margin: var(--ios-spacing-sm) 0;
}

.ios-tiptap-editor li[data-type="taskItem"] {
  display: flex;
  align-items: flex-start;
  gap: var(--ios-spacing-sm); /* 8px */
  margin: var(--ios-spacing-xs) 0;
}

/* Checkbox label - 44px touch target per Apple HIG */
.ios-tiptap-editor li[data-type="taskItem"] > label {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--ios-touch-target-min); /* 44px */
  height: var(--ios-touch-target-min); /* 44px */
  margin-top: -0.5em; /* Align with first line of text */
  margin-left: -11px; /* Center the 22px checkbox in 44px target */
  cursor: pointer;
}

/* Checkbox visual - 22px circle */
.ios-tiptap-editor li[data-type="taskItem"] > label > input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 22px;
  height: 22px;
  border: 2px solid var(--ios-text-tertiary);
  border-radius: 50%;
  background: transparent;
  cursor: pointer;
  position: relative;

  /* Spring transition for satisfying toggle feel */
  transition:
    background-color var(--motion-toggle),
    border-color var(--motion-toggle),
    transform var(--motion-button);

  /* GPU acceleration for smooth 60fps */
  will-change: transform, background-color;
}

.ios-tiptap-editor li[data-type="taskItem"] > label > input[type="checkbox"]:hover {
  border-color: var(--ios-yellow);
}

/* Tactile press feedback */
.ios-tiptap-editor li[data-type="taskItem"] > label > input[type="checkbox"]:active {
  transform: scale(0.9);
}

.ios-tiptap-editor li[data-type="taskItem"] > label > input[type="checkbox"]:checked {
  background: var(--ios-yellow);
  border-color: var(--ios-yellow);
  /* Subtle pop effect on check */
  animation: checkbox-pop var(--motion-duration-normal) var(--motion-spring-expressive);
}

@keyframes checkbox-pop {
  0% { transform: scale(0.8); }
  100% { transform: scale(1); }
}

.ios-tiptap-editor li[data-type="taskItem"] > label > input[type="checkbox"]:checked::after {
  content: 'âœ“';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: var(--ios-font-footnote);
  color: var(--ios-bg-primary);
  font-weight: 600;
}

.ios-tiptap-editor li[data-type="taskItem"] > div {
  flex: 1;
  min-width: 0;
  padding-top: 0.125em; /* Slight alignment adjustment */
}

.ios-tiptap-editor li[data-type="taskItem"][data-checked="true"] > div p {
  text-decoration: line-through;
  color: var(--ios-text-secondary);
}

/* ============================================================================
   BLOCKQUOTE
   ============================================================================ */

.ios-tiptap-editor blockquote {
  border-left: 3px solid var(--ios-yellow);
  margin: var(--ios-spacing-sm) 0;
  padding-left: var(--ios-spacing-md);
  color: var(--ios-text-secondary);
}

/* ============================================================================
   CODE
   ============================================================================ */

.ios-tiptap-editor code {
  background: var(--ios-bg-tertiary);
  padding: 0.125em 0.375em; /* 2px 6px at base */
  border-radius: 4px;
  font-family: 'SF Mono', ui-monospace, Menlo, Monaco, monospace;
  font-size: 0.9em;
}

.ios-tiptap-editor pre {
  background: var(--ios-bg-tertiary);
  padding: var(--ios-spacing-sm) var(--ios-spacing-md); /* 8px 16px */
  border-radius: var(--ios-spacing-sm); /* 8px */
  overflow-x: auto;
  margin: var(--ios-spacing-sm) 0;
}

.ios-tiptap-editor pre code {
  background: none;
  padding: 0;
}

/* ============================================================================
   HORIZONTAL RULE
   ============================================================================ */

.ios-tiptap-editor hr {
  border: none;
  border-top: 1px solid var(--ios-separator);
  margin: var(--ios-spacing-md) 0; /* 16px */
}

/* ============================================================================
   LINKS
   ============================================================================ */

.ios-tiptap-editor a {
  color: var(--ios-blue);
  text-decoration: underline;
  text-underline-offset: 0.15em;
}

/* ============================================================================
   SELECTION
   ============================================================================ */

.ios-tiptap-editor ::selection {
  background: var(--ios-yellow);
  color: var(--ios-bg-primary);
}

/* ============================================================================
   FOCUS
   ============================================================================ */

.ios-tiptap-wrapper:focus-within {
  outline: none;
}

/* ============================================================================
   LIGHT MODE OVERRIDES
   ============================================================================ */

@media (prefers-color-scheme: light) {
  .ios-tiptap-editor h1 {
    /* In light mode, use primary text color for h1 */
    color: var(--ios-text-primary);
  }

  .ios-tiptap-editor mark {
    background-color: #fff3b0;
    color: #000;
  }
}

/* ============================================================================
   REDUCED MOTION
   Respect user preference for reduced motion
   ============================================================================ */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  .ios-tiptap-editor li[data-type="taskItem"] > label > input[type="checkbox"] {
    transition: none;
    animation: none;
    will-change: auto;
  }
}
